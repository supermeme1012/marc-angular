"use strict";(self.webpackChunkriskanalysis=self.webpackChunkriskanalysis||[]).push([[989],{7989:(mt,O,n)=>{n.r(O),n.d(O,{RoleModule:()=>ct});var d=n(6895),u=n(7579),v=n(8505),x=n(262),Z=n(2843),f=n(2722),A=n(4004),s=n(5412),l=n(4006),t=n(4650),b=n(6693),Y=n(9439),y=n(6284),R=n(7404),m=n(9549),T=n(4144),N=n(8271),C=n(4859);let E=(()=>{class o{constructor(e,i,r,c,p,h,S){this.dialogData=e,this.apiService=i,this.passwordService=r,this.formBuilder=c,this.formValidation=p,this.notificationService=h,this.dialogRef=S,this.subject=new u.x}ngOnInit(){this.createForm()}createForm(){this.form=this.formBuilder.group({roleName:["",[l.kI.required,l.kI.minLength(4)]],roleDescription:["",[l.kI.required,l.kI.minLength(2)]]})}storeOrUpdate(){this.apiService.store(this.form.value).pipe((0,v.b)(e=>{this.notificationService.show(e),this.dialogRef.close(!0)}),(0,x.K)(e=>(this.formValidation.validateAllFields(this.form,e),(0,Z._)(()=>e))),(0,f.R)(this.subject)).subscribe()}ngOnDestroy(){this.subject.next(!0),this.subject.complete()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.WI),t.Y36(b.N),t.Y36(Y.C),t.Y36(l.qu),t.Y36(y.m),t.Y36(R.g),t.Y36(s.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-user"]],decls:22,vars:4,consts:[[1,"flex-auto"],["mat-dialog-title",""],[1,"mt-8",3,"formGroup"],[1,"mat-typography"],[1,"w-full"],["matInput","","type","text","formControlName","roleName"],["name","roleName",3,"form"],["matInput","","type","text","formControlName","roleDescription"],["name","roleDescription",3,"form"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Create a new role"),t.qZA(),t.TgZ(3,"form",2)(4,"mat-dialog-content",3)(5,"mat-form-field",4)(6,"mat-label"),t._uU(7,"Role Name"),t.qZA(),t._UZ(8,"input",5),t.TgZ(9,"mat-error"),t._UZ(10,"form-error",6),t.qZA()(),t.TgZ(11,"mat-form-field",4)(12,"mat-label"),t._uU(13,"Role Description"),t.qZA(),t._UZ(14,"input",7),t.TgZ(15,"mat-error"),t._UZ(16,"form-error",8),t.qZA()()(),t.TgZ(17,"mat-dialog-actions",9)(18,"button",10),t._uU(19,"Cancel"),t.qZA(),t.TgZ(20,"button",11),t.NdJ("click",function(){return i.storeOrUpdate()}),t._uU(21,"Save"),t.qZA()()()()),2&e&&(t.xp6(3),t.Q6J("formGroup",i.form),t.xp6(7),t.Q6J("form",i.form),t.xp6(6),t.Q6J("form",i.form),t.xp6(4),t.Q6J("disabled",!i.form.valid))},dependencies:[s.ZT,s.uh,s.xY,s.H8,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.TO,m.KE,m.hX,T.Nt,N.A,C.lW],encapsulation:2,changeDetection:0}),o})();function j(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"form",4)(2,"mat-dialog-content",5)(3,"mat-form-field",6)(4,"mat-label"),t._uU(5,"Role Name"),t.qZA(),t._UZ(6,"input",7),t.TgZ(7,"mat-error"),t._UZ(8,"form-error",8),t.qZA()(),t.TgZ(9,"mat-form-field",6)(10,"mat-label"),t._uU(11,"Role Description"),t.qZA(),t._UZ(12,"input",9),t.TgZ(13,"mat-error"),t._UZ(14,"form-error",10),t.qZA()()(),t.TgZ(15,"mat-dialog-actions",11)(16,"button",12),t._uU(17,"Cancel"),t.qZA(),t.TgZ(18,"button",13),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.storeOrUpdate())}),t._uU(19,"Save"),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(7),t.Q6J("form",e.form),t.xp6(6),t.Q6J("form",e.form),t.xp6(4),t.Q6J("disabled",!e.form.valid)}}function Q(o,a){1&o&&t._uU(0,"Please wait...")}let $=(()=>{class o{constructor(e,i,r,c,p,h,S){this.dialogData=e,this.apiService=i,this.passwordService=r,this.formBuilder=c,this.formValidation=p,this.notificationService=h,this.dialogRef=S,this.subject=new u.x}ngOnInit(){this.initFormFields(this.dialogData.roleId)}initFormFields(e){this.form$=this.apiService.initDataForEdit(e).pipe((0,A.U)(i=>(this.form=this.formBuilder.group({id:[i.data.id],roleName:[{value:i.data.roleName,disabled:!0},[l.kI.required,l.kI.minLength(4)]],roleDescription:[i.data.roleDescription,[l.kI.required,l.kI.minLength(2)]]}),this.form)))}storeOrUpdate(){this.apiService.update(this.form.value).pipe((0,v.b)(e=>{this.notificationService.show(e),this.dialogRef.close(!0)}),(0,x.K)(e=>(this.formValidation.validateAllFields(this.form,e),(0,Z._)(()=>e))),(0,f.R)(this.subject)).subscribe()}ngOnDestroy(){this.subject.next(!0),this.subject.complete()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.WI),t.Y36(b.N),t.Y36(Y.C),t.Y36(l.qu),t.Y36(y.m),t.Y36(R.g),t.Y36(s.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-user"]],decls:7,vars:4,consts:[[1,"flex-auto"],["mat-dialog-title",""],[4,"ngIf","ngIfElse"],["loading",""],[1,"mt-8",3,"formGroup"],[1,"mat-typography"],[1,"w-full"],["matInput","","type","text","formControlName","roleName"],["name","roleName",3,"form"],["matInput","","type","text","formControlName","roleDescription"],["name","roleDescription",3,"form"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Update Role"),t.qZA(),t.YNc(3,j,20,4,"ng-container",2),t.ALo(4,"async"),t.YNc(5,Q,1,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const r=t.MAs(6);t.xp6(3),t.Q6J("ngIf",t.lcZ(4,2,i.form$))("ngIfElse",r)}},dependencies:[d.O5,s.ZT,s.uh,s.xY,s.H8,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.TO,m.KE,m.hX,T.Nt,N.A,C.lW,d.Ov],encapsulation:2,changeDetection:0}),o})();var U=n(805),I=n(1149);function L(o,a){if(1&o&&(t.TgZ(0,"div",15)(1,"div",16)(2,"span",17),t._uU(3),t.qZA()()()),2&o){const e=a.$implicit;t.xp6(3),t.Oqu(e.operationName)}}const D=function(){return{height:"20rem"}};function B(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"form",4)(2,"mat-dialog-content",5)(3,"div",6)(4,"mat-form-field")(5,"mat-label"),t._uU(6,"Role Name"),t.qZA(),t._UZ(7,"input",7),t.TgZ(8,"mat-error"),t._UZ(9,"form-error",8),t.qZA()(),t.TgZ(10,"div",9)(11,"label"),t._uU(12,"Select Operations"),t.qZA(),t.TgZ(13,"p-pickList",10),t.YNc(14,L,4,1,"ng-template",11),t.qZA()()()(),t.TgZ(15,"mat-dialog-actions",12)(16,"button",13),t._uU(17,"Cancel"),t.qZA(),t.TgZ(18,"button",14),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.update())}),t._uU(19,"Save"),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(8),t.Q6J("form",e.form),t.xp6(4),t.Q6J("source",e.operations)("target",e.targetOperations)("dragdrop",!0)("responsive",!0)("sourceStyle",t.DdM(9,D))("targetStyle",t.DdM(10,D)),t.xp6(5),t.Q6J("disabled",!e.form.valid)}}function M(o,a){1&o&&t._uU(0,"Please wait...")}let F=(()=>{class o{constructor(e,i,r,c,p,h){this.dialogData=e,this.apiService=i,this.formBuilder=r,this.formValidation=c,this.notificationService=p,this.dialogRef=h,this.subject=new u.x,this.operations=[],this.targetOperations=[]}ngOnInit(){this.initFormFields(this.dialogData.role)}initFormFields(e){this.form$=this.apiService.initEditRoleOperationForm(e.id).pipe((0,A.U)(i=>(this.operations=i.data.operations.filter(r=>!i.data.role.operationIds.includes(r.id)),this.targetOperations=i.data.operations.filter(r=>i.data.role.operationIds.includes(r.id)),this.createForm(e,i.data))))}createForm(e,i){return this.form=this.formBuilder.group({id:[e.id],roleName:[{value:e.roleName,disabled:!0}],operationIds:[i.role.operationIds]}),this.form}update(){const e={id:this.form.value.id,operationIds:this.targetOperations.map(i=>i.id)};this.apiService.updateRoleOperations(e).pipe((0,v.b)(i=>{this.notificationService.show(i),this.dialogRef.close(!1)}),(0,x.K)(i=>(this.formValidation.validateAllFields(this.form,i.error.data),(0,Z._)(()=>i))),(0,f.R)(this.subject)).subscribe()}ngOnDestroy(){this.subject.next(!0),this.subject.complete()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(s.WI),t.Y36(b.N),t.Y36(l.qu),t.Y36(y.m),t.Y36(R.g),t.Y36(s.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["edit-role-operations"]],decls:7,vars:4,consts:[[1,"flex-auto","p-5"],["mat-dialog-title",""],[4,"ngIf","ngIfElse"],["loading",""],[1,"mt-8",3,"formGroup"],[1,"h-180"],[1,"flex","flex-col","flex-auto"],["matInput","","type","text","formControlName","roleName"],["name","roleName",3,"form"],[1,"flex","flex-col","mb-5"],["sourceHeader","Available","targetHeader","Selected","filterBy","operationName","sourceFilterPlaceholder","Search by name","targetFilterPlaceholder","Search by name",3,"source","target","dragdrop","responsive","sourceStyle","targetStyle"],["pTemplate","item"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"],[1,"product-item"],[1,"product-list-detail"],[1,"mb-2"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Manage Ldap Title"),t.qZA(),t.YNc(3,B,20,11,"ng-container",2),t.ALo(4,"async"),t.YNc(5,M,1,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const r=t.MAs(6);t.xp6(3),t.Q6J("ngIf",t.lcZ(4,2,i.form$))("ngIfElse",r)}},dependencies:[d.O5,U.jx,s.ZT,s.uh,s.xY,s.H8,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,m.TO,m.KE,m.hX,T.Nt,N.A,C.lW,I.G,d.Ov],encapsulation:2}),o})();var _=n(2510),g=n(403),J=n(1327),w=n(5593);function q(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"div",9)(1,"button",10),t.NdJ("click",function(r){t.CHM(e);const c=t.MAs(3);return t.KtG(c.toggle(r))}),t.qZA(),t._UZ(2,"p-menu",11,12),t.qZA()}if(2&o){const e=t.oxw();t.xp6(2),t.Q6J("popup",!0)("model",e.menuItems)}}function K(o,a){if(1&o&&(t.TgZ(0,"th",14),t._uU(1),t._UZ(2,"p-sortIcon",15),t.qZA()),2&o){const e=a.$implicit;t.s9C("pSortableColumn",e.field),t.xp6(1),t.hij(" ",e.header," "),t.xp6(1),t.s9C("field",e.field)}}function G(o,a){if(1&o&&(t.TgZ(0,"tr"),t.YNc(1,K,3,3,"th",13),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.cols)}}const H=function(o,a){return{"true-icon pi-check-circle":o,"false-icon pi-times-circle":a}};function P(o,a){if(1&o&&(t.TgZ(0,"td"),t._UZ(1,"i",20),t.qZA()),2&o){const e=t.oxw().$implicit,i=t.oxw().$implicit;t.xp6(1),t.Q6J("ngClass",t.WLB(1,H,i[e.field],!i[e.field]))}}function W(o,a){if(1&o&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit,i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i[e.field][e.subField]," ")}}function X(o,a){if(1&o&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit,i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i[e.field]," ")}}function k(o,a){if(1&o&&(t.ynx(0),t.YNc(1,P,2,4,"td",18),t.YNc(2,W,2,1,"td",19),t.YNc(3,X,2,1,"td",19),t.BQk()),2&o){const e=a.$implicit;t.xp6(1),t.Q6J("ngIf","boolean"===e.type),t.xp6(1),t.Q6J("ngIf","text"===e.type&&e.subField),t.xp6(1),t.Q6J("ngIf","text"===e.type&&!e.subField)}}function z(o,a){if(1&o&&(t.TgZ(0,"tr",16),t.YNc(1,k,4,3,"ng-container",17),t.qZA()),2&o){const e=a.$implicit,i=t.oxw();t.Q6J("pSelectableRow",e),t.xp6(1),t.Q6J("ngForOf",i.cols)}}let V=(()=>{class o{constructor(e,i,r,c,p){this.notificationService=e,this.apiService=i,this.matDialog=r,this.confirmationService=c,this.router=p,this.cols=[{field:"roleName",type:"text",header:"Name",iconClass:"pi-angle-right"},{field:"roleDescription",type:"text",header:"Description",iconClass:"pi-angle-right"}],this.menuItems=[{label:"LDAP Titles",icon:"pi pi-user-plus",command:()=>this.goToLdapTitles()},{label:"Add",icon:"pi pi-user-plus",command:()=>this.add()},{label:"Edit",icon:"pi pi-user-edit",command:()=>this.edit()},{label:"Edit Operations",icon:"pi pi-user-edit",command:()=>this.editOperations()},{label:"Delete",icon:"pi pi-trash",command:()=>this.delete()}],this.subject=new u.x,this.subjectDashboard=new u.x}ngOnDestroy(){this.subject.next(!0),this.subject.complete()}ngOnInit(){this.loadData()}add(){this.matDialog.open(E,{width:"40%"}).afterClosed().subscribe(i=>{console.log(`Dialog result: ${i}`),i&&this.loadData()})}edit(){this.checkRowSelected(),this.matDialog.open($,{width:"40%",data:{roleId:this.selectedRow?this.selectedRow.id:null}}).afterClosed().subscribe(i=>{console.log(`Dialog result: ${i}`),i&&this.loadData()})}editOperations(){this.checkRowSelected(),this.matDialog.open(F,{width:"40%",data:{role:this.selectedRow?this.selectedRow:null}}).afterClosed().subscribe(i=>{console.log(`Dialog result: ${i}`),i&&this.loadData()})}delete(){this.checkRowSelected(),this.confirmationService.confirm({message:"Do you want to remove selected users?",accept:()=>{this.apiService.delete(this.selectedRow.id).pipe((0,v.b)(e=>{this.notificationService.show(e),this.loadData()}),(0,x.K)(e=>(this.notificationService.show(e.data.message),(0,Z._)(()=>e))),(0,f.R)(this.subject)).subscribe()}})}checkRowSelected(){if(!this.selectedRow)throw this.notificationService.error("Please select a row"),Error("Please select a row")}loadData(){this.loading=!0,setTimeout(()=>{this.apiService.list().pipe((0,A.U)(e=>{this.roles=e.data.rows,this.totalRecords=e.data.records,this.loading=!1}),(0,f.R)(this.subject)).subscribe()},10)}goToLdapTitles(){this.router.navigateByUrl("/admin/roles/ldap-titles")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(R.g),t.Y36(b.N),t.Y36(s.uw),t.Y36(U.YP),t.Y36(_.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-role"]],decls:10,vars:8,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex-auto","p-6","sm:p-10"],[1,"flex"],[1,"text-3xl","font-bold","mt-0","mb-6"],["dataKey","roleName","scrollDirection","horizontal","selectionMode","single",3,"value","lazy","paginator","scrollable","selection","rows","totalRecords","loading","selectionChange"],["dt2",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],[1,"flex",2,"justify-content","space-between"],["type","button","pButton","","icon","pi pi-angle-double-down","label","Actions",1,"ml-auto","p-button-rounded","p-button-sm",3,"click"],["appendTo","body",3,"popup","model"],["menu",""],[3,"pSortableColumn",4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","truncate",4,"ngIf"],[1,"pi",3,"ngClass"],[1,"truncate"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),t._uU(4,"Role List"),t.qZA()(),t.TgZ(5,"p-table",4,5),t.NdJ("selectionChange",function(c){return i.selectedRow=c}),t.YNc(7,q,4,2,"ng-template",6),t.YNc(8,G,2,1,"ng-template",7),t.YNc(9,z,2,2,"ng-template",8),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("value",i.roles)("lazy",!1)("paginator",!0)("scrollable",!0)("selection",i.selectedRow)("rows",10)("totalRecords",i.totalRecords)("loading",i.loading))},dependencies:[d.mk,d.sg,d.O5,g.iA,U.jx,g.lQ,g.Ei,g.fz,J.v2,w.Hq]}),o})();var tt=n(3238),et=n(5655),ot=n(7392),it=n(7155),nt=n(8739),at=n(5722),lt=n(4466),rt=n(6709);const st=[{path:"",component:V},{path:"edit-role",component:F}];let ct=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.ez,_.Bz.forChild(st),tt.si,et.Tx,ot.Ps,it.p0,nt.TU,g.U$,at.q4,J.$9,w.hJ,s.Is,l.UX,m.lN,T.c,lt.m,rt.p9,C.ot,I.f]}),o})()}}]);